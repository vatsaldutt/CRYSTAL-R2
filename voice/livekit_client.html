<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LiveKit Audio Client</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; }
    #participants { margin-top: 1rem; }
    audio { display: block; margin: 0.5rem 0; }
  </style>
  <!-- Include LiveKit JS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/livekit-client/dist/livekit-client.umd.min.js"></script>
</head>
<body>
  <h1>Join LiveKit Room</h1>
  <label>Your Name: <input type="text" id="username" value="Guest"></label>
  <button id="joinBtn">Join Room</button>

  <div id="participants">
    <h2>Participants</h2>
    <ul id="participantList"></ul>
  </div>

  <script>
    const { Room, RoomEvent, LocalAudioTrack } = LivekitClient;

    const joinBtn = document.getElementById('joinBtn');
    const participantList = document.getElementById('participantList');

    joinBtn.onclick = async () => {
      const identity = document.getElementById('username').value || 'Guest';
      const wsUrl = 'ws://localhost:7880'; // local LiveKit server
      const roomName = 'demo-room';

      const token = prompt('Enter your participant access token');

      const room = new Room();
      room.on(RoomEvent.ParticipantConnected, updateParticipants);
      room.on(RoomEvent.ParticipantDisconnected, updateParticipants);
      room.on(RoomEvent.TrackSubscribed, (track, publication, participant) => {
        if (track.kind === 'audio') {
          const audioEl = track.attach();
          const li = document.createElement('li');
          li.textContent = participant.identity;
          participantList.appendChild(li);
          participantList.appendChild(audioEl);
        }
      });

      try {
        await room.connect(wsUrl, token, { 
          // option: specify room name via token's room parameter
        });
        await room.localParticipant.publishTrack(await LocalAudioTrack.create());
        updateParticipants();
        alert(`Connected to room "${roomName}" as ${identity}`);
      } catch (err) {
        console.error('Connection error:', err);
        alert('Failed to connect. Check token, server URL, and console.');
      }

      function updateParticipants() {
        // Clear list and re-render
        participantList.innerHTML = '';
        room.participants.forEach(p => {
          const li = document.createElement('li');
          li.textContent = p.identity;
          participantList.appendChild(li);
        });
      }
    };
  </script>
</body>
</html>
